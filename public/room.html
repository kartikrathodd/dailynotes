<!DOCTYPE html>
<html>
<head>
  <title>Daily Notes - Room</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f7f7f7; }
    .container { max-width: 600px; margin: 20px auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    #status { color: green; margin-bottom: 10px; }
    #participants { font-size: 14px; color: #666; margin-bottom: 10px; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 250px; overflow-y: auto; background: #fafafa; margin-bottom: 10px; }
    .msg { padding: 5px 10px; margin: 5px 0; border-radius: 5px; }
    .you { background: #d1e7dd; text-align: right; }
    .them { background: #f8d7da; text-align: left; }
    input, button { padding: 10px; border: none; border-radius: 5px; }
    button { background: #007bff; color: white; cursor: pointer; margin-left: 5px; }
    #flowerContainer { text-align: center; margin-bottom: 10px; }
    #flowerImage { height: 60px; }
    .flower-rain img { position: absolute; animation: drop 4s linear; z-index: 999; }
    @keyframes drop {
      0% { top: -50px; }
      100% { top: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="status"></div>
    <div id="participants"></div>
    <div id="flowerContainer"></div>
    <div id="messages"></div>
    <input id="msg" placeholder="Write your message...">
    <button onclick="sendMsg()">Send</button>
    <button onclick="leaveRoom()">Exit</button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const room = new URLSearchParams(window.location.search).get("room");
    document.title = `Room ${room}`;
    socket.emit("join", room);

    function sendMsg() {
      const msg = document.getElementById("msg").value;
      socket.emit("message", { room, text: msg });
      document.getElementById("msg").value = "";
    }

    function leaveRoom() {
      socket.emit("leave");
      window.location.href = "/";
    }

    socket.on("participants", count => {
      document.getElementById("participants").innerText = `${count} participant${count !== 1 ? 's' : ''}`;
    });

    socket.on("partner_joined", () => {
      document.getElementById("status").innerText = "🎉 Someone joined the room!";
    });

    socket.on("partner_left", () => {
      document.getElementById("status").innerText = "❌ Someone left the room.";
    });

    socket.on("message", data => {
      const div = document.createElement("div");
      div.className = `msg ${data.sender}`;
      div.innerText = data.text;
      document.getElementById("messages").appendChild(div);
    });

    socket.on("flower", flower => {
      const flowerContainer = document.getElementById("flowerContainer");
      flowerContainer.innerHTML = `
        <div>
          <img id="flowerImage" src="https://em-content.zobj.net/source/apple/354/${flower}.png" alt="${flower}"><br>
          <button onclick="acceptFlower()">Accept (from your boy)</button>
        </div>`;
    });

    function acceptFlower() {
      const rainContainer = document.createElement("div");
      rainContainer.classList.add("flower-rain");
      document.body.appendChild(rainContainer);

      for (let i = 0; i < 30; i++) {
        const img = document.createElement("img");
        img.src = "https://em-content.zobj.net/source/apple/354/cherry-blossom.png";
        img.style.left = `${Math.random() * 100}vw`;
        img.style.top = `-${Math.random() * 100}px`;
        img.style.height = "40px";
        rainContainer.appendChild(img);
      }

      setTimeout(() => {
        rainContainer.remove();
      }, 4000);
    }
  </script>
</body>
</html>

